{% extends "base.html" %}
{% block title %}{{ 'Edit' if mode == 'edit' else 'New' }} Contact - Tiger Marketing CRM{% endblock %}
{% block page_title %}{{ 'Edit Contact' if mode == 'edit' else 'New Contact' }}{% endblock %}

{% block header_actions %}
<a href="{{ url_for('contacts_list') }}" class="btn btn-secondary">← Back</a>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-body">
        <form method="POST" action="{{ url_for('contact_edit', contact_id=contact.CONTACT_ID) if mode == 'edit' else url_for('contact_new') }}">
            <div class="form-grid">
                <div class="form-group">
                    <label>First Name *</label>
                    <input type="text" name="first_name" class="form-control" value="{{ contact.FIRST_NAME if contact else '' }}" required>
                </div>
                <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" name="last_name" class="form-control" value="{{ contact.LAST_NAME if contact else '' }}">
                </div>
                <div class="form-group">
                    <label>Company</label>
                    <input type="text" name="company" class="form-control" value="{{ contact.COMPANY if contact else '' }}">
                </div>
                <div class="form-group">
                    <label>Job Title</label>
                    <input type="text" name="job_title" class="form-control" value="{{ contact.JOB_TITLE if contact else '' }}">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" class="form-control" value="{{ contact.EMAIL if contact else '' }}">
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" name="phone" class="form-control" value="{{ contact.PHONE if contact else '' }}">
                </div>
                <div class="form-group full-width">
                    <label>Address</label>
                    <input type="text" name="address" class="form-control" value="{{ contact.ADDRESS if contact else '' }}">
                </div>
                <div class="form-group">
                    <label>City</label>
                    <input type="text" name="city" class="form-control" value="{{ contact.CITY if contact else 'Auburn' }}">
                </div>
                <div class="form-group">
                    <label>State</label>
                    <input type="text" name="state" class="form-control" value="{{ contact.STATE if contact else 'AL' }}" maxlength="2">
                </div>
                <div class="form-group">
                    <label>ZIP</label>
                    <input type="text" name="zip" class="form-control" value="{{ contact.ZIP if contact else '' }}" maxlength="10">
                </div>
                <div class="form-group">
                    <label>Neighborhood</label>
                    <input type="text" name="neighborhood" class="form-control" value="{{ contact.NEIGHBORHOOD if contact else '' }}"
                           placeholder="e.g. Moores Mill, Yarbrough Farms">
                </div>
                <div class="form-group">
                    <label>Contact Type</label>
                    <select name="contact_type" class="form-control">
                        {% for t in ['Lead', 'Prospect', 'Customer', 'Referral', 'Vendor', 'Other'] %}
                        <option value="{{ t }}" {% if contact and contact.CONTACT_TYPE == t %}selected{% endif %}>{{ t }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Lead Source</label>
                    <select name="lead_source" class="form-control">
                        <option value="">-- Select --</option>
                        {% for s in ['Door Knock', 'Flyer', 'Google', 'Referral', 'Facebook', 'Nextdoor', 'Cold Call', 'Website', 'Yard Sign', 'Other'] %}
                        <option value="{{ s }}" {% if contact and contact.LEAD_SOURCE == s %}selected{% endif %}>{{ s }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Lead Status</label>
                    <select name="lead_status" class="form-control">
                        {% for s in ['New', 'Contacted', 'Qualified', 'Proposal', 'Won', 'Lost', 'Inactive'] %}
                        <option value="{{ s }}" {% if contact and contact.LEAD_STATUS == s %}selected{% endif %}>{{ s }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Interest Services</label>
                    <input type="text" name="interest_services" class="form-control"
                           value="{{ contact.INTEREST_SERVICES if contact else '' }}"
                           placeholder="Window Washing, Power Washing, Gutter Cleaning">
                </div>
                <div class="form-group">
                    <label>Property Type</label>
                    <select name="property_type" class="form-control">
                        <option value="">-- Select --</option>
                        {% for p in ['Residential', 'Commercial', 'HOA', 'Multi-Family', 'Government', 'Other'] %}
                        <option value="{{ p }}" {% if contact and contact.PROPERTY_TYPE == p %}selected{% endif %}>{{ p }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Estimated Value ($)</label>
                    <input type="number" name="estimated_value" class="form-control" step="0.01"
                           value="{{ contact.ESTIMATED_VALUE if contact and contact.ESTIMATED_VALUE else '' }}">
                </div>
                <div class="form-group">
                    <label>Rating (1-5)</label>
                    <select name="rating" class="form-control">
                        <option value="">-- Select --</option>
                        {% for r in range(1, 6) %}
                        <option value="{{ r }}" {% if contact and contact.RATING == r %}selected{% endif %}>{{ '⭐' * r }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Assigned To</label>
                    <input type="text" name="assigned_to" class="form-control"
                           value="{{ contact.ASSIGNED_TO if contact else 'Jason' }}">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" name="do_not_contact" id="dnc"
                           {% if contact and contact.DO_NOT_CONTACT %}checked{% endif %}>
                    <label for="dnc" style="text-transform: none; font-size: 14px; color: var(--text-primary);">Do Not Contact</label>
                </div>
                <div class="form-group full-width">
                    <label>Notes</label>
                    <textarea name="notes" class="form-control" rows="4">{{ contact.NOTES if contact else '' }}</textarea>
                </div>
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary">{{ 'Update Contact' if mode == 'edit' else 'Create Contact' }}</button>
                <a href="{{ url_for('contacts_list') }}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
